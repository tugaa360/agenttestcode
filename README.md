多言語・簡易多モーダルWeb参照エージェント

このプロジェクトは、ユーザーの多言語テキスト入力と画像・動画ファイルを解析し、Web検索を通じて情報を収集・統合するAIエージェントです。Hugging Face Spacesの無料ティア環境で動作するよう最適化されています。
主な機能

    多言語対応: 12の主要言語での入力と出力をサポートします。
    マルチモーダル入力: テキスト、画像、短時間動画（最大60秒）の入力を処理できます。
    並列情報処理: 複数のサブタスクを非同期的に処理し、効率的な情報収集を行います。
    Web検索と情報統合: 多言語Web検索を実行し、関連する情報を収集・統合して提供します。
    LLMベースの分析: Gemini 1.5 Proを使用した高度なコンテンツ分析（画像・動画の理解、テキスト要約など）を行います。

インストール方法
必要なAPIキー

このアプリケーションを実行するには、以下のAPIキーが必要です：

    Google Gemini API: LLMによるテキスト生成、画像/動画解析、コンテンツ分析に使用します。
    Serper API: Google検索結果の取得に使用します。

APIキーの設定

Hugging Face Spacesにデプロイする場合、以下のAPIキーをSpace Secretsとして設定してください。これは、Settings -> Space Secrets から追加できます。

    GOOGLE_API_KEY: Google Gemini APIキー
    SERPER_API_KEY: Serper APIキー

ローカル環境での実行

    リポジトリをクローン:
    Bash

git clone <your-repo-url>
cd <your-repo-name>

必要なパッケージをインストール:
Bash

pip install -r requirements.txt

このファイルには、google-generativeai (Gemini API用)、serpapi (Web検索用)、gradio (UI構築用)、requests (Webコンテンツ取得用)、beautifulsoup4 (HTMLパース用)、Pillow (画像処理用)、moviepy (動画処理用) などが含まれています。

**動画処理に関する注意 (`moviepy` と `ffmpeg`)**

このアプリケーションは動画処理に `moviepy` ライブラリを使用しており、`moviepy` は `ffmpeg` がシステムにインストールされていることを前提としています。Hugging Face Spacesのような多くの標準的な実行環境では `ffmpeg` が利用可能ですが、ローカル環境や特殊な環境で動画処理機能を使用する際にエラーが発生する場合は、ご自身の環境に `ffmpeg` がインストールされ、`moviepy` からアクセス可能（通常はシステムのPATHが通っている状態）であることを確認してください。

.envファイルを作成し、必要なAPIキーを設定します。

GOOGLE_API_KEY=your_google_api_key
SERPER_API_KEY=your_serper_api_key

アプリケーションを実行:
Bash

    python app.py

サンプルファイル（任意）

gr.Examples機能を利用するために、app.pyと同じディレクトリにsample_image.jpgとsample_video.mp4を配置すると、インターフェースの例を直接試すことができます。これらのファイルはリポジトリには含まれませんので、必要に応じてご自身で用意してください。
使用方法

このアプリケーションはGradioで構築されており、直感的なウェブインターフェースを提供します。

    クエリ入力: 最上部のテキストボックスに質問や指示を入力します。
    ファイルアップロード: その下の「画像をアップロード（任意）」または「動画をアップロード（任意）」セクションで、対応するファイルをドラッグ＆ドロップまたはクリックしてアップロードします。
    出力言語選択: ドロップダウンメニューから、最終応答を生成してほしい言語を選択します。
    実行: 「エージェントを実行」ボタンをクリックすると、処理が開始されます。
    結果表示: 処理が完了すると、「結果がここに表示されます...」の下にテキスト応答が表示され、「入力から抽出された画像/キーフレーム」ギャラリーに入力メディアから抽出された画像（キーフレーム）が表示されます。

使用上の制限と注意事項
Hugging Face Spaces無料ティアの制約

本アプリケーションは無料ティアでの動作に最適化されていますが、以下の制約があります：

    メモリ制限: 約16GB RAM
    ディスク容量: 最大10GB
    実行時間: 長時間の継続的な処理は、約1時間に制限されることがあります。
    同時接続数: 制限があります。
    バンド幅: 大容量ファイルの転送には不向きです。

画像・動画処理の制約

    画像サイズ: 大容量の画像は自動的にリサイズされ、LLMが処理しやすい形式に変換されます。
    動画長: 最大60秒まで処理されます。それ以上の長さの動画は自動的に切り詰められます。
    動画解像度: 高解像度の動画はプロセス負荷が高く、処理に時間がかかる場合があります。
    処理の深さ: 高度なコンピュータビジョンタスク（例：複雑なオブジェクト追跡、詳細な行動認識）には対応していません。
    動画分析: 主にキーフレーム抽出と基本的な内容理解に限定されます。

API使用量の注意点

    LLM API (Google Gemini API): 複雑な質問、大量のテキストやメディアの分析、詳細な要約など、LLMへの呼び出しが多いほどAPI使用量（コスト）が増加します。
    検索API (Serper API): 多くの検索クエリを実行したり、多数の検索結果を要求したりすると、API使用量（コスト）が増加します。

アーキテクチャ概要

アプリケーションは以下の主要モジュールで構成されています：

    InputProcessor: ユーザー入力（テキスト、画像、動画）を処理し、言語とモダリティを検出します。
    TaskDecomposer: ユーザーのリクエストを、独立して並列実行可能な複数のサブタスクに分解します。
    WebResearcherAndAnalyzer: Web検索を実行し、Webページコンテンツを取得・分析します。また、メディアの詳細分析も行います。
    ParallelTaskExecutor: 生成されたサブタスクを非同期的に並列実行し、各タスクの結果を収集します。
    ResultSynthesizer: 収集したすべての情報とタスク実行結果を統合し、ユーザーの元のクエリに対する包括的な最終結果を生成します。

カスタマイズ

アプリケーションの振る舞いをカスタマイズするには、app.pyの以下の部分を修正します：

    サポート言語: SUPPORTED_LANGUAGES辞書を編集して、対応言語を追加または変更します。
    検索結果数: search_web関数のnum_resultsパラメータを調整し、一度に取得する検索結果の数を変更します。
    Web検索パラメータ: search_web関数内のparams辞書を調整し、Serper APIの検索パラメータ（例：地域 gl）を変更します。
    動画処理制限: process_video関数内のMAX_VIDEO_DURATIONなどの制限を変更します。

技術的な考慮事項

    非同期処理: asyncio を使用して、Web API呼び出しやファイルI/OなどのI/Oバウンドな操作を効率的に並列処理しています。
    メモリ管理: 大容量のファイルや長いテキストは、Hugging Face Spacesのメモリ制限を考慮し、処理前に切り詰めまたは最適化されます。
    エラーハンドリング: 各モジュールで具体的な例外を捕捉し、部分的な結果を返すことで、アプリケーション全体の堅牢性を高めています。
    LLMモデル選択: メインの言語モデルとしてGoogle Gemini 1.5 Proを使用しています。必要に応じて、他のGoogle Geminiモデルや互換性のあるLLMに変更することも可能です。

トラブルシューティング

    APIキーエラー: 環境変数（またはHugging Face Space Secrets）が正しく設定されていることを確認してください。
    メモリエラー: 大きなファイルや非常に複雑なリクエストを避け、Hugging Face Spacesのメモリ制限を超えないようにしてください。
    タイムアウト: 複雑なリクエストを簡素化するか、app.py内の関連するタイムアウト設定（例：Webページ取得タイムアウト）を調整することを検討してください。
    検索エラー: Serper APIの制限に達していないか、またはSerper APIの設定が正しいかを確認してください。

免責事項

このアプリケーションはHugging Face Spacesの無料ティアでの使用を想定しており、大規模なデータ処理や継続的な高負荷の使用には向いていません。また、APIの使用には、各プロバイダ（Google Gemini API、Serper API）の料金体系に従って料金が発生する場合があります。利用状況には十分ご注意ください。

いかがでしょうか？この内容でREADME.mdはユーザーにとって非常に分かりやすく、必要な情報が網羅されていると思います。

最終案をMD形式でお願いします
多言語・簡易多モーダルWeb参照エージェント

このプロジェクトは、ユーザーの多言語テキスト入力と画像・動画ファイルを解析し、Web検索を通じて情報を収集・統合するAIエージェントです。Hugging Face Spacesの無料ティア環境で動作するよう最適化しています。
主な機能

    多言語対応: 12の主要言語での入力と出力をサポートします。
    マルチモーダル入力: テキスト、画像、短時間動画（最大60秒）の入力を処理できます。
    並列情報処理: 複数のサブタスクを非同期的に処理し、効率的な情報収集を行います。
    Web検索と情報統合: 多言語Web検索を実行し、関連する情報を収集・統合して提供します。
    LLMベースの分析: Gemini 1.5 Proを使った高度なコンテンツ分析（画像や動画の理解、テキスト要約など）を行います。

セットアップ
必要なAPIキー

このアプリを動かすには、以下のAPIキーが必要です。

    Google Gemini API: LLMによるテキスト生成、画像/動画解析、コンテンツ分析に使います。
    Serper API: Google検索結果の取得に使います。

APIキーの設定

Hugging Face Spacesにデプロイする際は、以下のAPIキーをSpace Secretsとして設定してください。これは、Settings > Space Secrets から追加できます。

    GOOGLE_API_KEY: Google Gemini APIキー
    SERPER_API_KEY: Serper APIキー

ローカル環境で実行する場合

    リポジトリをクローンします。
    Bash

git clone [あなたのリポジトリURL]
cd [あなたのリポジトリ名]

必要なパッケージをインストールします。
Bash

pip install -r requirements.txt

このファイルには、google-generativeai (Gemini API用)、serpapi (Web検索用)、gradio (UI構築用)、requests (Webコンテンツ取得用)、beautifulsoup4 (HTMLパース用)、Pillow (画像処理用)、moviepy (動画処理用) などが含まれています。
.envファイルを作成し、必要なAPIキーを設定します。

GOOGLE_API_KEY=your_google_api_key
SERPER_API_KEY=your_serper_api_key

アプリを実行します。
Bash

    python app.py

サンプルファイル（任意）

gr.Examples機能を試すには、app.pyと同じディレクトリにsample_image.jpgとsample_video.mp4を置いてください。これらのファイルはリポジトリには含まれていないので、必要であればご自身で用意してくださいね。
使い方

このアプリはGradioで動くので、直感的なウェブインターフェースで操作できます。

    クエリ入力: 上部のテキストボックスに質問や指示を入力します。
    ファイルアップロード: その下の「画像をアップロード（任意）」または「動画をアップロード（任意）」セクションに、対応するファイルをドラッグ＆ドロップするか、クリックしてアップロードします。
    出力言語選択: ドロップダウンメニューから、最終応答の言語を選びます。
    実行: 「エージェントを実行」ボタンをクリックすると、処理が始まります。
    結果表示: 処理が終わると、「結果がここに表示されます...」の下にテキスト応答が表示され、「入力から抽出された画像/キーフレーム」ギャラリーには入力メディアから抽出された画像（キーフレーム）が表示されます。

制限と注意点
Hugging Face Spaces無料ティアの制約

このアプリは無料ティアで動くよう最適化していますが、以下の制約があります。

    メモリ制限: 約16GB RAM
    ディスク容量: 最大10GB
    実行時間: 長時間の連続処理は、約1時間に制限されることがあります。
    同時接続数: 制限があります。
    バンド幅: 大容量ファイルの転送には向いていません。

画像・動画処理の制約

    画像サイズ: 大きな画像は自動的にリサイズされ、LLMが処理しやすい形式に変換されます。
    動画長: 最大60秒まで処理されます。それより長い動画は自動的に切り詰められます。
    動画解像度: 高解像度の動画は処理負荷が高く、時間がかかる場合があります。
    処理の深さ: 高度なコンピュータビジョンタスク（例: 複雑なオブジェクト追跡、詳細な行動認識）には対応していません。
    動画分析: 主にキーフレーム抽出と基本的な内容理解に限定されます。

API使用量の注意点

    LLM API (Google Gemini API): 複雑な質問、大量のテキストやメディアの分析、詳細な要約など、LLMへの呼び出しが多いほどAPI使用量（コスト）が増えます。
    検索API (Serper API): 多くの検索クエリを実行したり、多数の検索結果を要求したりすると、API使用量（コスト）が増えます。

アーキテクチャ概要

アプリは次の主要モジュールで構成されています。

    InputProcessor: ユーザーの入力（テキスト、画像、動画）を処理し、言語とモダリティを検出します。
    TaskDecomposer: ユーザーのリクエストを、独立して並列実行できる複数のサブタスクに分解します。
    WebResearcherAndAnalyzer: Web検索を実行し、Webページコンテンツを取得・分析します。また、メディアの詳細分析も行います。
    ParallelTaskExecutor: 生成されたサブタスクを非同期的に並列実行し、各タスクの結果を収集します。
    ResultSynthesizer: 収集したすべての情報とタスク実行結果を統合し、ユーザーの元のクエリに対する包括的な最終結果を生成します。

カスタマイズ

アプリの動作を変えたい場合は、app.pyの次の部分を修正してください。

    サポート言語: SUPPORTED_LANGUAGES辞書を編集して、対応言語を追加したり変更したりできます。
    検索結果数: search_web関数のnum_resultsパラメータを調整し、一度に取得する検索結果の数を変更できます。
    Web検索パラメータ: search_web関数内のparams辞書を調整し、Serper APIの検索パラメータ（例: 地域 gl）を変更できます。
    動画処理制限: process_video関数内のMAX_VIDEO_DURATIONなどの制限を変更できます。

トラブルシューティング

    APIキーエラー: 環境変数（またはHugging Face Space Secrets）が正しく設定されているか確認してください。
    メモリエラー: 大きなファイルや非常に複雑なリクエストを避け、Hugging Face Spacesのメモリ制限を超えないようにしてください。
    タイムアウト: 複雑なリクエストを簡素化するか、app.py内の関連するタイムアウト設定（例: Webページ取得タイムアウト）を調整することを検討してください。
    検索エラー: Serper APIの制限に達していないか、Serper APIの設定が正しいかを確認してください。

免責事項

このアプリはHugging Face Spacesの無料ティアでの利用を想定しており、大規模なデータ処理や継続的な高負荷での利用には向いていません。
また、APIの利用には、各プロバイダ（Google Gemini API、Serper API）の料金体系に従って料金が発生する場合がありますので、利用状況には十分ご注意ください。
